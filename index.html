<!DOCTYPE html>

<html lang="en">
<head>
<title>Wapuu Gallery VR</title>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1.0">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<link rel="apple-touch-icon" href="wapuus/original-wapuu.png" />
<style>
body
{
    width: 100%;
    height: 100%;
    background-color: #000;
    color: #fff;
    margin: 0px;
    padding: 0;
    overflow: hidden;
}
</style>
<script type="text/javascript">
var wapuus = [
    "original-wapuu.png",
    "WapuuPepa.png",
    "WapuuPepe.png",
    "basile-wapuu.png",
    "cheesesteak-wapuu.png",
    "dokuganryu-wapuu.png",
    "fes-wapuu.png",
    "kani-wapuu.png",
    "krimpet-wapuu.png",
    "maikochan-and-wapuu.png",
    "manchester-wapuu.png",
    "matsuri-wapuu.png",
    "mineiro-wapuu.png",
    "onsen-wapuu.png",
    "pretzel-wapuu.png",
    "rocky-wapuu.png",
    "scott-wapuu.png",
    "shachihoko-wapuu.png",
    "shikasenbei-wapuu.png",
    "sydney-wapuu.png",
    "takoyaki-wapuu.png",
    "tampa-gasparilla-wapuu.png",
    "tonkotsu-wapuu.png",
    "wapuda-shingen.png",
    "wapuu-der-ber.png",
    "wapuu-france.png",
    "wapuujlo.png",
    "wapuunder.png",
    "wapuushkin-wapuu.png",
    "wck-wapuu.png",
    "wct2012.png",
    "wct2013.png",
    "wctokyo_wapuu.png",
];

WebVRConfig = {};
</script>
</head>

<body></body>

<script src="lib/threejs/build/three.js"></script>
<script src="lib/threejs/examples/js/controls/VRControls.js"></script>
<script src="lib/threejs/examples/js/effects/VREffect.js"></script>
<script src="lib/threejs/examples/js/geometries/TextGeometry.js"></script>
<script src="lib/webvr-polyfill/build/webvr-polyfill.js"></script>
<script src="build/webvr-manager.js"></script>

<script>
function getRandom( min, max ) {
  return Math.random() * ( max - min ) + min;
}

function shuffle( array ) {
  var n = array.length, t, i;

  while (n) {
    i = Math.floor(Math.random() * n--);
    t = array[n];
    array[n] = array[i];
    array[i] = t;
  }

  return array;
}

function animate( timestamp, cube, y, speed ) {
    cube.position.z += speed;
    renderer.render( scene, camera );
    controls.update();
    manager.render( scene, camera, timestamp );
    requestAnimationFrame( function(){
        if ( cube.position.z > -1 && cube.position.z <= 0.5 ) {
            animate( timestamp, cube, y, 0.005 );
        } else if ( cube.position.z > 0.5 && cube.position.z <= 10 ) {
            animate( timestamp, cube, y, 0.25 );
        } else if ( cube.position.z > 10 ) {
            scene.remove( cube );
        } else {
            animate( timestamp, cube, y, speed );
        }
    } );
}

function add_cosmos( scene ) {
    var pgeometry = new THREE.Geometry();
    for ( var n = 0; n < 1000; n++ ) {
        var vertex = new THREE.Vector3();
        vertex.x = ( Math.random() - 0.5 ) * 10;
        vertex.y = ( Math.random() - 0.5 ) * 10;
        vertex.z = ( Math.random() - 0.5 ) * 10;
        pgeometry.vertices.push( vertex );
    }
    var pmaterial = new THREE.PointsMaterial( {
        size: 0.01,
        color: 0xFFFFE0,
        blending: THREE.AdditiveBlending,
        transparent: true,
        fog: true
    } );
    var particles = new THREE.Points( pgeometry, pmaterial );
    particles.fog = new THREE.FogExp2( 0xffffff, 1 );
    scene.add( particles );
}

function add_logo( scene ) {
    var material = new THREE.MeshBasicMaterial( {
        transparent: true,
        map:THREE.ImageUtils.loadTexture( 'img/logo.png', {}, function() {
            renderer.render(scene, camera);
        } )
    } );
    var geometry = new THREE.PlaneGeometry( 1, 1 );
    logo = new THREE.Mesh( geometry, material );
    logo.position.x = 0;
    logo.position.y = 0;
    logo.position.z = -1;
    scene.add( logo );
}

function init() {
    renderer = new THREE.WebGLRenderer( { antialias: true } );
    renderer.setPixelRatio( window.devicePixelRatio );

    document.body.appendChild( renderer.domElement );

    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 10 );
    controls = new THREE.VRControls( camera );
    effect = new THREE.VREffect( renderer );
    effect.setSize( window.innerWidth, window.innerHeight );
    manager = new WebVRManager( renderer, effect, { hideButton: false } );

    add_cosmos( scene );
    add_logo( scene );

    wapuus = shuffle( wapuus );
    wapuu_objects = [];
    for ( var i = 0; i < wapuus.length; i++ ) {
        var material = new THREE.MeshBasicMaterial( {
            transparent: true,
            map:THREE.ImageUtils.loadTexture( 'wapuus/' + wapuus[i], {}, function() {
                renderer.render(scene, camera);
            } )
        } );
        material.side = THREE.DoubleSide;

        var size;
        size = getRandom( 2, 10 ) / 10;
        var geometry = new THREE.PlaneGeometry( size, size );
        var wapuu = new THREE.Mesh( geometry, material );
        wapuu_objects.push( wapuu );
    }

    window.addEventListener('click', run, true);
}

function run( e ){
    scene.remove( logo );
    window.removeEventListener('click', run, true);
    for ( var i = 0; i < wapuu_objects.length; i++ ) {
        setTimeout( function( index ) {
            var x, y, z, speed;
            x = getRandom( 0, 8 ) / 10 - 0.4;
            y = getRandom( 0, 8 ) / 10 - 0.4;
            z = -10;
            speed = getRandom( 10, 30 ) / 100;

            wapuu_objects[index].position.x = x;
            wapuu_objects[index].position.y = y;
            wapuu_objects[index].position.z = z;

            scene.add( wapuu_objects[index] );
            animate( null, wapuu_objects[index], y, speed );

            if ( ( index + 1 ) == wapuus.length ) {
                setTimeout( function(){
                    add_logo( scene );
                    window.addEventListener('click', run, true);
                }, 10000 );
            }
        }, i * 5000, i );
    }
}

var renderer, scene, camera, controls, effect, manager, logo, wapuu_objects;
init();

</script>

</html>
